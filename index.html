<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de ROI — Easyjur</title>
  <style>
    :root{
      --bg:#0b0f14;--panel:#121821;--card:#0f141c;--muted:#7c8aa5;--text:#e6edf7;--b1:#223047;--a1:#76c7ff;--a2:#9be07d;--a3:#f6b26b;--a4:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,ui-sans-serif,system-ui; background:var(--bg); color:var(--text); margin:0}
    header{padding:20px; text-align:center; background:var(--panel)}
    h1{margin:0}
    .wrap{max-width:1100px; margin:20px auto; padding:20px; background:var(--panel); border-radius:12px}
    .inputs{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px}
    .field{display:flex; flex-direction:column}
    label{font-size:13px; margin-bottom:6px; color:var(--muted)}
    input,select{padding:10px; border-radius:10px; border:1px solid var(--b1); background:var(--card); color:#fff}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:14px}
    .btn{padding:10px 16px; border:none; border-radius:10px; cursor:pointer; font-weight:bold}
    .btn.primary{background:#2c7be5; color:#fff}
    .btn.ghost{background:transparent; border:1px dashed var(--b1); color:#9fb5d9}
    canvas{width:100%; height:420px; background:#0e1520; border-radius:12px; margin-top:16px}
    .results{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px; margin-top:16px}
    .kpi{background:var(--card); padding:12px; border-radius:10px; border:1px solid var(--b1)}
    .kpi .label{font-size:12px; color:var(--muted)}
    .kpi .value{font-size:20px; font-weight:800; margin-top:6px}
    .legend{display:flex; gap:14px; align-items:center; flex-wrap:wrap; font-size:12px; color:var(--muted); margin-top:8px}
    .dot{width:10px; height:10px; border-radius:999px; display:inline-block; margin-right:6px}
    .eff{background:var(--a1)} .rev{background:var(--a2)} .inv{background:var(--a3)} .roi{background:var(--a4)}
    details{margin-top:10px; color:#b7c6e2}
    details summary{cursor:pointer}
  </style>
</head>
<body>
  <header>
    <h1>Calculadora de ROI — Easyjur</h1>
    <p>Preencha as variáveis. A projeção considera <b>rampa de adoção de 90 dias</b>.</p>
  </header>

  <div class="wrap">
    <h3 style="margin-top:0">Parâmetros</h3>
    <div class="inputs">
      <div class="field">
        <label>Horas trabalhadas por dia (por pessoa)</label>
        <input type="number" id="hours_day" value="8" min="0" step="0.5">
      </div>
      <div class="field">
        <label>Valor da hora (R$)</label>
        <input type="number" id="hour_rate" value="80" min="0" step="5">
      </div>
      <div class="field">
        <label>Pessoas impactadas (tamanho da equipe)</label>
        <input type="number" id="team_size" value="5" min="1" step="1">
      </div>
      <div class="field">
        <label>Minutos desperdiçados por dia (por pessoa)</label>
        <input type="number" id="wasted_minutes" value="30" min="0" step="5">
      </div>
      <div class="field">
        <label>Redução do desperdício com Easyjur (%)</label>
        <input type="number" id="waste_reduction_pct" value="60" min="0" max="100" step="1">
      </div>
      <div class="field">
        <label>Contratos fechados por mês (incremento devido ao Easyjur)</label>
        <input type="number" id="contracts_month" value="3" min="0" step="1">
      </div>
      <div class="field">
        <label>Ticket médio (R$)</label>
        <input type="number" id="ticket" value="2500" min="0" step="100">
      </div>
      <div class="field">
        <label>Receita preservada (churn evitado) (R$/mês)</label>
        <input type="number" id="retained_revenue_month" value="2000" min="0" step="100">
      </div>
      <div class="field">
        <label>Custo Easyjur (R$/mês)</label>
        <input type="number" id="cost_monthly" value="1500" min="0" step="50">
      </div>
      <div class="field">
        <label>Custo de implementação único (R$)</label>
        <input type="number" id="cost_onetime" value="2000" min="0" step="100">
      </div>
      <div class="field">
        <label>Forma da rampa (90 dias)</label>
        <select id="ramp_shape">
          <option value="s">S-curve (logística)</option>
          <option value="linear">Linear</option>
          <option value="stairs">Degraus 30/60/90</option>
        </select>
      </div>
      <div class="field">
        <label>Dia inicial (para go‑live deslocado)</label>
        <input type="number" id="start_day" value="1" min="1" max="90" step="1">
      </div>
    </div>

    <div class="row">
      <button type="button" class="btn primary" id="btnCalc">Calcular ROI</button>
      <button type="button" class="btn ghost" id="btnCsv">Baixar CSV</button>
    </div>

    <div class="legend">
      <span><span class="dot eff"></span>Eficiência (acum.)</span>
      <span><span class="dot rev"></span>Faturamento (acum.)</span>
      <span><span class="dot inv"></span>Investimento (acum.)</span>
      <span><span class="dot roi"></span>ROI total (%)</span>
    </div>
    <canvas id="chart"></canvas>

    <div class="results">
      <div class="kpi"><div class="label">Eficiência (90d)</div><div class="value" id="k_eff">—</div></div>
      <div class="kpi"><div class="label">Faturamento (90d)</div><div class="value" id="k_rev">—</div></div>
      <div class="kpi"><div class="label">Investimento (90d)</div><div class="value" id="k_inv">—</div></div>
      <div class="kpi"><div class="label">ROI Total (90d)</div><div class="value" id="k_roi">—</div></div>
    </div>

    <details>
      <summary>Como calculamos?</summary>
      <ol>
        <li>Rampa 90 dias (linear/S‑curve/degraus) gera um <em>fator de adoção</em> diário entre 0 e 1.</li>
        <li>Eficiência diária = fator × ( equipe × (minutos desperdiçados × redução% ÷ 60) × R$/hora ).</li>
        <li>Faturamento diário = fator × ( (contratos/mês × ticket)/30 + (receita preservada/mês)/30 ).</li>
        <li>Investimento diário = (mensalidade/30) + (implementação/90).</li>
        <li>ROI acumulado = (benefícios acumulados − investimento acumulado) ÷ investimento acumulado.</li>
      </ol>
    </details>
  </div>

  <script>
  (function(){
    function $(s){ return document.querySelector(s); }
    var canvas = $('#chart');
    var ctx = (canvas && canvas.getContext) ? canvas.getContext('2d') : null;
    var state = { data:null };

    function ensureCtx(){ if(!canvas || !ctx){ console.warn('Canvas/Context indisponível.'); return false; } return true; }

    function pxFixCanvas(){
      if(!ensureCtx()) return null;
      var dpr = Math.max(1, window.devicePixelRatio||1);
      var rect = canvas.getBoundingClientRect();
      var Wcss = rect.width || 1000;
      var Hcss = 420;
      canvas.width = Math.round(Wcss * dpr);
      canvas.height = Math.round(Hcss * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      return {Wcss:Wcss, Hcss:Hcss};
    }

    function ramp(shape, n, startDay){
      var arr = new Array(n); for(var i=0;i<n;i++) arr[i]=0;
      var s = Math.max(1, Math.min(n, startDay||1)) - 1;
      for(var i=0;i<n;i++){
        if(i<s){arr[i]=0;continue}
        var denom = Math.max(1, (n - s - 1));
        var t = (i - s) / denom; // 0..1
        var r=0;
        if(shape==='linear'){ r = Math.max(0, Math.min(1,t)); }
        else if(shape==='stairs'){
          if(t<1/3) r=0.5; else if(t<2/3) r=0.8; else r=1;
        } else {
          var k=8; var x=(t-0.5)*k; var u=1/(1+Math.exp(-x));
          var r0=1/(1+Math.exp(k/2)); var r1=1/(1+Math.exp(-k/2));
          r=(u-r0)/(r1-r0); r=Math.max(0,Math.min(1,r));
        }
        arr[i]=r;
      }
      return arr;
    }

    function val(id, fallback){ var el=$(id); return Number(el? el.value : fallback||0) || 0; }
    function valStr(id, fallback){ var el=$(id); return el? el.value : (fallback||''); }

    function compute(){
      var DAYS = 90;
      var hoursDay = val('#hours_day',0); // não usado diretamente, mas previsto p/ extensões
      var hourRate = val('#hour_rate',0);
      var teamSize = val('#team_size',0);
      var wastedMin = val('#wasted_minutes',0);
      var wasteRedPct = Math.max(0, Math.min(100, val('#waste_reduction_pct',0)))/100;
      var contracts = val('#contracts_month',0);
      var ticket = val('#ticket',0);
      var retained = val('#retained_revenue_month',0);
      var costMonthly = val('#cost_monthly',0);
      var costOnetime = val('#cost_onetime',0);
      var shape = valStr('#ramp_shape','s') || 's';
      var startDay = val('#start_day',1) || 1;

      var savedHoursPerPerson = (wastedMin/60) * wasteRedPct; // horas poupadas por pessoa/dia
      var dailyEffBase = teamSize * savedHoursPerPerson * hourRate;
      var dailyRevBase = (contracts * ticket)/30 + (retained/30);
      var dailyInv = (costMonthly/30) + (costOnetime/90);

      var rr = ramp(shape, DAYS, startDay);
      var cumEff=[], cumRev=[], cumInv=[], cumROI=[]; var cE=0,cR=0,cI=0;
      for(var i=0;i<DAYS;i++){
        cE += rr[i]*dailyEffBase;
        cR += rr[i]*dailyRevBase;
        cI += dailyInv;
        cumEff.push(cE); cumRev.push(cR); cumInv.push(cI);
        var roi = cI>0 ? (cE+cR-cI)/cI : NaN; cumROI.push(roi);
      }
      return {DAYS:DAYS, rr:rr, cumEff:cumEff, cumRev:cumRev, cumInv:cumInv, cumROI:cumROI,
        totals:{eff:cE, rev:cR, inv:cI, roi:(cI>0? (cE+cR-cI)/cI : NaN)}};
    }

    function draw(){
      try{
        var dims = pxFixCanvas(); if(!dims){ console.warn('Sem contexto/canvas.'); return; }
        var W = dims.Wcss; var H = dims.Hcss;
        state.data = compute();
        var data = state.data;
        ctx.clearRect(0,0,W,H);
        var pad = {l:60, r:60, t:20, b:30};
        function x(i){ return pad.l + (i/(data.DAYS-1))*(W-pad.l-pad.r); }
        var moneyMax = Math.max.apply(null, [1].concat(data.cumEff, data.cumRev, data.cumInv));
        function yM(v){ return pad.t + (1 - (v/moneyMax))*(H-pad.t-pad.b); }
        var roiArr = data.cumROI.map(function(v){ return isFinite(v)?v:0; });
        var roiMax = Math.max.apply(null, [0.01].concat(roiArr));
        var roiMin = Math.min.apply(null, [0].concat(roiArr));
        function yR(v){ return pad.t + (1 - ((v - roiMin)/((roiMax-roiMin)||1)))*(H-pad.t-pad.b); }

        // grid
        ctx.strokeStyle = '#223047'; ctx.lineWidth = 1; ctx.beginPath();
        for(var g=0; g<=5; g++){ var gy = pad.t + g*(H-pad.t-pad.b)/5; ctx.moveTo(pad.l,gy); ctx.lineTo(W-pad.r,gy);} ctx.stroke();

        function path(arr, yfn){ ctx.beginPath(); for(var i=0;i<arr.length;i++){ var xx=x(i), yy=yfn(arr[i]); if(i===0) ctx.moveTo(xx,yy); else ctx.lineTo(xx,yy);} }
        function stroke(color,w){ ctx.strokeStyle=color||'#5aa9e6'; ctx.lineWidth=w||2; ctx.stroke(); }

        var styles = window.getComputedStyle(document.documentElement);
        path(data.cumEff, yM); stroke(styles.getPropertyValue('--a1')||'#76c7ff');
        path(data.cumRev, yM); stroke(styles.getPropertyValue('--a2')||'#9be07d');
        path(data.cumInv, yM); stroke(styles.getPropertyValue('--a3')||'#f6b26b');
        path(data.cumROI, yR); stroke(styles.getPropertyValue('--a4')||'#ff6b6b');

        // x labels
        ctx.fillStyle = '#8ea3c4'; ctx.font = '12px system-ui';
        for(var d=0; d<data.DAYS; d+=15){ var xx=x(d); ctx.fillText((d+1)+'d', xx-8, H-8); }

        // y left labels (money)
        for(var gy2=0; gy2<=5; gy2++){
          var v = moneyMax*(1-gy2/5);
          var ly = pad.t + gy2*(H-pad.t-pad.b)/5;
          var txt = v.toLocaleString('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0});
          ctx.fillText(txt, 6, ly+4);
        }
        // y right (ROI)
        for(var gr=0; gr<=5; gr++){
          var v2 = roiMin + (roiMax-roiMin)*(1-gr/5);
          var ly2 = pad.t + gr*(H-pad.t-pad.b)/5;
          var txt2 = (v2*100).toFixed(0).replace('.',',')+'%';
          ctx.fillText(txt2, W-50, ly2+4);
        }

        // KPIs
        function fmtBRL(v){ return v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }
        function fmtPct(v){ return (isFinite(v)? (v*100).toFixed(1).replace('.',',')+'%':'—'); }
        $('#k_eff').textContent = fmtBRL(data.totals.eff);
        $('#k_rev').textContent = fmtBRL(data.totals.rev);
        $('#k_inv').textContent = fmtBRL(data.totals.inv);
        $('#k_roi').textContent = fmtPct(data.totals.roi);
      } catch(e){
        console.error('Erro ao desenhar:', e);
        alert('Ops! Algo impediu o cálculo do ROI. Veja o console do navegador para detalhes (F12).');
      }
    }

    function downloadCsv(){
      if(!state.data){ draw(); }
      var data = state.data; if(!data) return;
      var lines = ['dia,rampa_pct,eff_acum,rev_acum,beneficio_acum,invest_acum,roi'];
      for(var i=0;i<data.DAYS;i++){
        var ce=data.cumEff[i], cr=data.cumRev[i], ci=data.cumInv[i];
        var cb=ce+cr, roi=data.cumROI[i];
        lines.push([i+1,(data.rr[i]*100).toFixed(2),ce.toFixed(2),cr.toFixed(2),cb.toFixed(2),ci.toFixed(2),roi.toFixed(6)].join(','));
      }
      var blob = new Blob([lines.join('
')], {type:'text/csv;charset=utf-8;'});
      var url = URL.createObjectURL(blob);
      var a=document.createElement('a'); a.href=url; a.download='roi_easyjur_90dias.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    function bind(){
      var btnCalc = $('#btnCalc');
      var btnCsv = $('#btnCsv');
      if(btnCalc){ btnCalc.addEventListener('click', draw); }
      if(btnCsv){ btnCsv.addEventListener('click', downloadCsv); }
      var fields = document.querySelectorAll('input,select');
      for(var i=0;i<fields.length;i++){ fields[i].addEventListener('input', function(){ draw(); }); }
      window.addEventListener('resize', draw);
    }

    if(document.readyState==='loading'){
      document.addEventListener('DOMContentLoaded', function(){ bind(); draw(); });
    } else { bind(); draw(); }
  })();
</script>
</body>
</html>
