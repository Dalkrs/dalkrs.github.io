<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ROI Easyjur — 1 ano (com marcos trimestrais)</title>
    <style>
        /* ====== Marca Easyjur ====== */
        :root {
            --ej-primary: #e5293f; /* vermelho */
            --ej-gray-1: #acbac2; /* cinza claro */
            --ej-gray-2: #7f919a; /* cinza médio */
            --ej-white: #ffffff;
            --ej-black: #111;
        }

        /* Fonte Borna: troque o src abaixo para o caminho do seu arquivo WOFF2 */
        @font-face {
            font-family: 'Borna';
            src: url('Borna.woff2') format('woff2'); /* substitua pelo caminho real */
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }

        /* ====== Layout ====== */
        html, body { height: 100%; }
        body { margin: 0; background: var(--ej-white); color: var(--ej-black); font-family: 'Borna', Arial, Helvetica, sans-serif; }
        .wrap { max-width: 1080px; margin: 0 auto; padding: 24px 16px; }

        /* Estilo para o logo */
        .logo {
            display: block;
            margin: 0 auto 24px;
            max-width: 250px;
            height: auto;
        }
        
        /* Estilo para o título centralizado */
        .title {
            text-align: center;
            margin: 0 0 14px;
            font-size: 22px;
            color: var(--ej-black);
        }
        
        .panel { background: var(--ej-white); border: 1px solid var(--ej-gray-1); border-radius: 14px; padding: 16px; }

        /* Container de colunas com Flexbox para as seções de input */
        .column-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        /* Cada coluna com seus inputs - Agora usando GRID */
        .input-column {
            display: grid;
            gap: 12px;
            flex: 1 1 220px; /* Base de 220px para garantir espaço */
            border-right: 1px solid var(--ej-gray-1); /* Separador entre colunas */
            padding-right: 12px;
        }
        
        .input-column:last-of-type {
            border-right: none;
            padding-right: 0;
        }
        
        .input-box {
            padding-bottom: 12px;
            margin-bottom: 12px;
        }
        .input-box:last-of-type {
            margin-bottom: 0;
        }

        /* Títulos dos grupos */
        .group-title {
            margin: 0 0 10px;
            font-size: 16px;
            color: var(--ej-gray-2);
            width: 100%;
        }

        label { font-size: 12px; color: #35424a; display: block; margin: 0 0 6px; }
        input, select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--ej-gray-1); background: var(--ej-white); color: var(--ej-black); }
        input:focus, select:focus { outline: none; border-color: var(--ej-primary); box-shadow: 0 0 0 2px rgba(229, 41, 63, .15); }

        .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 12px; }
        button { padding: 10px 14px; border-radius: 10px; border: 1px solid transparent; cursor: pointer; font-weight: 700; }
        .primary { background: var(--ej-primary); color: var(--ej-white); }
        .ghost { background: transparent; color: var(--ej-black); border-color: var(--ej-gray-2); }

        .legend { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; font-size: 12px; color: #333; margin-top: 8px; }
        .sw { width: 14px; height: 3px; border-radius: 2px; display: inline-block; margin-right: 6px; vertical-align: middle; }
        .sw.eff { background: var(--ej-gray-2); }
        .sw.rev { background: var(--ej-primary); }
        .sw.inv { background: var(--ej-gray-1); }
        .sw.roi { 
            width: 14px; 
            height: 0; 
            border-bottom: 2px dashed var(--ej-primary);
            display: inline-block; 
            margin-right: 6px; 
            vertical-align: middle; 
        }

        canvas { width: 100%; height: 420px; background: #fafbfc; border: 1px solid var(--ej-gray-1); border-radius: 12px; margin-top: 10px; cursor: crosshair; }

        .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; margin-top: 12px; }
        .kpi { background: #fafbfc; border: 1px solid var(--ej-gray-1); border-radius: 10px; padding: 12px; }
        .kpi .l { font-size: 12px; color: #35424a; }
        .kpi .v { font-size: 20px; font-weight: 800; margin-top: 6px; color: var(--ej-black); }

        /* Estilo para a tela expansiva (acordeão) */
        .accordion {
            background-color: #f5f5f5;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
            transition: 0.4s;
            border-radius: 10px;
            margin-top: 12px;
        }

        .active, .accordion:hover {
            background-color: #ddd;
        }

        .accordion:after {
            content: '\25BC'; /* Caractere de triângulo para baixo */
            color: #777;
            font-weight: bold;
            float: right;
            margin-left: 5px;
        }

        .active:after {
            content: "\25B2"; /* Caractere de triângulo para cima */
        }

        .panel-formulas {
            padding: 0 18px;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
        }

        .panel-formulas pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Tooltip do gráfico */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            display: none;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="wrap">
        <img src="logo-easyjur-01.png" alt="Logo Easyjur" class="logo" />
        <h1 class="title">Calculadora de Crescimento e Investimento</h1>
        <div class="panel">
            <div class="column-container">
                <div class="input-column">
                    <h2 class="group-title">Custos e Investimento</h2>
                    <div class="input-box">
                        <label>Custo mensal (R$)</label>
                        <input id="cost_monthly" type="number" value="1500">
                    </div>
                    <div class="input-box">
                        <label>Implementação única (R$)</label>
                        <input id="cost_onetime" type="number" value="2000">
                    </div>
                </div>

                <div class="input-column">
                    <h2 class="group-title">Ganho por Eficiência</h2>
                    <div class="input-box">
                        <label>Valor/hora (R$)</label>
                        <input id="hour_rate" type="number" value="80">
                    </div>
                    <div class="input-box">
                        <label>Pessoas impactadas</label>
                        <input id="team_size" type="number" value="5">
                    </div>
                    <div class="input-box">
                        <label>Minutos desperdiçados/dia</label>
                        <input id="wasted_minutes" type="number" value="30">
                    </div>
                    <div class="input-box">
                        <label>Redução desperdício (%)</label>
                        <input id="waste_reduction_pct" type="number" value="60">
                    </div>
                </div>

                <div class="input-column">
                    <h2 class="group-title">Ganho de Faturamento</h2>
                    <div class="input-box">
                        <label>Contratos/mês</label>
                        <input id="contracts_month" type="number" value="3">
                    </div>
                    <div class="input-box">
                        <label>Ticket médio (R$)</label>
                        <input id="ticket" type="number" value="2500">
                    </div>
                    <div class="input-box">
                        <label>Receita preservada/mês (R$)</label>
                        <input id="retained_revenue_month" type="number" value="2000">
                    </div>
                </div>

                <div class="input-column">
                    <h2 class="group-title">Parâmetros do Gráfico</h2>
                    <div class="input-box">
                        <label>Rampa</label>
                        <select id="ramp_shape">
                            <option value="s">S-curve</option>
                            <option value="linear">Linear</option>
                            <option value="stairs">Degraus</option>
                        </select>
                    </div>
                    <div class="input-box">
                        <label>Dia inicial</label>
                        <input id="start_day" type="number" value="1">
                    </div>
                </div>
            </div>
            <div class="row">
                <button id="calc" class="primary" type="button">Calcular ROI</button>
                <button id="csv" class="ghost" type="button">Baixar CSV</button>
            </div>
            <div class="legend">
                <span><span class="sw eff"></span>Eficiência (acum.)</span>
                <span><span class="sw rev"></span>Faturamento (acum.)</span>
                <span><span class="sw inv"></span>Investimento (acum.)</span>
                <span><span class="sw roi"></span>ROI Total (x)</span>
            </div>
            <canvas id="chart"></canvas>
            <div id="tooltip"></div>
            <div class="kpis">
                <div class="kpi"><div class="l">Eficiência (365d)</div><div class="v" id="k_eff">—</div></div>
                <div class="kpi"><div class="l">Faturamento (365d)</div><div class="v" id="k_rev">—</div></div>
                <div class="kpi"><div class="l">Investimento (365d)</div><div class="v" id="k_inv">—</div></div>
                <div class="kpi"><div class="l">ROI Total (365d)</div><div class="v" id="k_roi">—</div></div>
            </div>
        </div>
        <button class="accordion">Fórmulas para o Cálculo do ROI</button>
        <div class="panel-formulas">
            <pre>
                ## Fórmulas de Cálculo

                **Ganho por Eficiência Diário:**
                `GanhoDiário = (MinutosDesperdicedos / 60) * (ReduçãoDesperdício / 100) * PessoasImpactadas * ValorHora`

                **Ganho de Faturamento Diário:**
                `GanhoDiário = (ContratosMensais * TicketMédio + ReceitaPreservadaMensal) / 30`

                **Custo Diário:**
                `CustoDiário = (CustoMensal / 30) + (CustoImplementaçãoÚnica / 90)`

                **Acumulado:**
                `ValorAcumulado = ∑(ValorDiário * Rampa)`

                **ROI (Retorno sobre Investimento):**
                `ROI = (EficiênciaAcumulada + FaturamentoAcumulada - InvestimentoAcumulado) / InvestimentoAcumulado`
                
                *O valor do ROI é exibido no formato "X", onde 1x significa que o investimento se pagou, 2x significa que o retorno foi o dobro do investimento, e assim por diante.*
            </pre>
        </div>
    </div>

<script>
(function(){
    function byId(id){ return document.getElementById(id); }

    var canvas = byId('chart');
    var ctx = canvas.getContext('2d');
    var tooltip = byId('tooltip');
    var DAYS = 365; // período de 1 ano
    var data = null; // para armazenar os dados calculados

    function fixCanvas(){
        var dpr = Math.max(1, window.devicePixelRatio || 1);
        var rect = canvas.getBoundingClientRect();
        var W = rect.width || 1000, H = 420;
        canvas.width = Math.round(W * dpr);
        canvas.height = Math.round(H * dpr);
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        return { W: W, H: H };
    }

    function ramp(shape, n, startDay){
        var rampDays = 90;
        var arr = new Array(n); for(var i = 0; i < n; i++) arr[i] = 0;
        var s = Math.max(1, Math.min(n, startDay || 1)) - 1;
        var e = Math.min(n - 1, s + rampDays - 1);
        for(var j = 0; j < n; j++){
            if(j < s){ arr[j] = 0; continue; }
            if(j > e){ arr[j] = 1; continue; }
            var t = (j - s) / Math.max(1, (e - s));
            var r = 0;
            if(shape === 'linear'){ r = Math.max(0, Math.min(1, t)); }
            else if(shape === 'stairs'){ r = (t < 1/3) ? 0.5 : (t < 2/3 ? 0.8 : 1); }
            else { var k = 8, x = (t - 0.5) * k; var u = 1 / (1 + Math.exp(-x)); var r0 = 1 / (1 + Math.exp(k / 2)); var r1 = 1 / (1 + Math.exp(-k / 2)); r = (u - r0) / (r1 - r0); if(r < 0) r = 0; if(r > 1) r = 1; }
            arr[j] = r;
        }
        return arr;
    }

    function compute(){
        var hourRate = Number(byId('hour_rate').value) || 0;
        var teamSize = Number(byId('team_size').value) || 0;
        var wastedMin = Number(byId('wasted_minutes').value) || 0;
        var wasteRed = Math.max(0, Math.min(100, Number(byId('waste_reduction_pct').value) || 0)) / 100;
        var contracts = Number(byId('contracts_month').value) || 0;
        var ticket = Number(byId('ticket').value) || 0;
        var retained = Number(byId('retained_revenue_month').value) || 0;
        var costMonthly = Number(byId('cost_monthly').value) || 0;
        var costOnetime = Number(byId('cost_onetime').value) || 0;
        var shape = byId('ramp_shape').value;
        var startDay = Number(byId('start_day').value) || 1;

        var savedHours = (wastedMin / 60) * wasteRed;
        var dailyEffBase = teamSize * savedHours * hourRate;
        var dailyRevBase = (contracts * ticket) / 30 + (retained / 30);
        var dailyInv = (costMonthly / 30) + (costOnetime / 90);

        var rr = ramp(shape, DAYS, startDay);
        var cE = 0, cR = 0, cI = 0, cumEff = [], cumRev = [], cumInv = [], cumROI = [];
        for(var i = 0; i < DAYS; i++){
            cE += rr[i] * dailyEffBase;
            cR += rr[i] * dailyRevBase;
            cI += dailyInv;
            cumEff.push(cE); cumRev.push(cR); cumInv.push(cI);
            cumROI.push(cI > 0 ? (cE + cR - cI) / cI : 0);
        }
        return {
            cumEff: cumEff,
            cumRev: cumRev,
            cumInv: cumInv,
            cumROI: cumROI,
            totals: {
                eff: cE,
                rev: cR,
                inv: cI,
                roi: (cI > 0 ? (cE + cR - cI) / cI : 0)
            }
        };
    }

    function draw(){
        var dims = fixCanvas(); var W = dims.W, H = dims.H;
        data = compute();

        ctx.clearRect(0, 0, W, H);
        var pad = { l: 60, r: 60, t: 24, b: 40 };
        function X(i){ return pad.l + (i / (DAYS - 1)) * (W - pad.l - pad.r); }

        // escalas
        var M = 1; for(var i = 0; i < DAYS; i++){ if(data.cumEff[i] > M) M = data.cumEff[i]; if(data.cumRev[i] > M) M = data.cumRev[i]; if(data.cumInv[i] > M) M = data.cumInv[i]; }
        function Ym(v){ return pad.t + (1 - (v / M)) * (H - pad.t - pad.b); }
        var roiMax = 0.01, roiMin = 0; for(var j = 0; j < DAYS; j++){ var rv = data.cumROI[j]; if(rv > roiMax) roiMax = rv; if(rv < roiMin) roiMin = rv; }
        function Yr(v){ var rng = (roiMax - roiMin) || 1; return pad.t + (1 - ((v - roiMin) / rng)) * (H - pad.t - pad.b); }

        // grade
        ctx.strokeStyle = '#e5eaee'; ctx.lineWidth = 1; ctx.beginPath();
        for(var gi = 0; gi <= 5; gi++){ var gy = pad.t + gi * (H - pad.t - pad.b) / 5; ctx.moveTo(pad.l, gy); ctx.lineTo(W - pad.r, gy); }
        ctx.stroke();

        // rótulos do eixo X por mês: M1..M12 (aprox. cada 30 dias)
        ctx.fillStyle = '#333'; ctx.font = '12px Borna, Arial';
        for(var d = 0, m = 1; d < DAYS; d += 30, m++){ var xx = X(d); ctx.fillText('M' + m, xx - 8, H - 12); }

        // marcadores de impacto (90, 180, 270, 360)
        var impacts = [90, 180, 270, 360];
        ctx.save(); ctx.setLineDash([6, 6]); ctx.strokeStyle = '#cfd7db';
        for(var mi = 0; mi < impacts.length; mi++){
            var day = impacts[mi] - 1; if(day < 0 || day >= DAYS) continue; var xx = X(day);
            ctx.beginPath(); ctx.moveTo(xx, pad.t); ctx.lineTo(xx, H - pad.b); ctx.stroke();
            ctx.fillStyle = '#7f919a';
            ctx.beginPath(); ctx.moveTo(xx, pad.t + 2); ctx.lineTo(xx - 6, pad.t + 14); ctx.lineTo(xx + 6, pad.t + 14); ctx.closePath(); ctx.fill();
            ctx.fillStyle = '#111'; ctx.font = '12px Borna, Arial';
            ctx.fillText((mi + 1) + 'º Impacto', xx + 8, pad.t + 16);
        }
        ctx.restore();

        // linhas
        function line(arr, y){ ctx.beginPath(); for(var k = 0; k < arr.length; k++){ var xx = X(k), yy = y(arr[k]); if(k === 0) ctx.moveTo(xx, yy); else ctx.lineTo(xx, yy); } ctx.stroke(); }

        // Eficiência
        ctx.lineWidth = 2; ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--ej-gray-2') || '#7f919a';
        line(data.cumEff, Ym);
        // Faturamento
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--ej-primary') || '#e5293f';
        line(data.cumRev, Ym);
        // Investimento
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--ej-gray-1') || '#acbac2';
        line(data.cumInv, Ym);
        // ROI (trilhado)
        ctx.setLineDash([4, 4]); ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--ej-primary') || '#e5293f';
        line(data.cumROI, Yr); ctx.setLineDash([]);

        // rótulos dos eixos Y
        ctx.fillStyle = '#333'; ctx.font = '12px Borna, Arial';
        for(var gy = 0; gy <= 5; gy++){
            var v = M * (1 - gy / 5); var ly = pad.t + gy * (H - pad.t - pad.b) / 5; var txt = v.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL', maximumFractionDigits: 0});
            ctx.fillText(txt, 8, ly + 4);
        }
        for(var gr = 0; gr <= 5; gr++){
            var v2 = roiMin + (roiMax - roiMin) * (1 - gr / 5); var ly2 = pad.t + gr * (H - pad.t - pad.b) / 5;
            var txt2 = (v2*100).toFixed(0) + '%';
            if (v2 > 0) txt2 = (v2).toFixed(1) + 'x';
            if (v2 < 1 && v2 > 0) txt2 = v2.toFixed(1) + 'x';
            if (v2 <= 0) txt2 = '0x';
            ctx.fillText(txt2, W - 44, ly2 + 4);
        }

        // KPIs
        function BRL(v){ return v.toLocaleString('pt-BR', {style: 'currency', currency: 'BRL'}); }
        function ROI(v){ return (v * 100).toFixed(0) + '% (' + v.toFixed(1) + 'x)'; }
        if (data.totals.roi <= 0.01) {
            byId('k_roi').textContent = '0x';
        } else {
            byId('k_roi').textContent = data.totals.roi.toFixed(1) + 'x';
        }
        byId('k_eff').textContent = BRL(data.totals.eff);
        byId('k_rev').textContent = BRL(data.totals.rev);
        byId('k_inv').textContent = BRL(data.totals.inv);
    }

    function downloadCsv(){
        var d = compute();
        var lines = ['dia,mes_index,eff_acum,rev_acum,beneficio_acum,invest_acum,roi'];
        for(var i = 0; i < DAYS; i++){
            var ce = d.cumEff[i], cr = d.cumRev[i], ci = d.cumInv[i]; var cb = ce + cr, roi = d.cumROI[i];
            var m = Math.floor(i / 30) + 1;
            lines.push([i + 1, m, ce.toFixed(2), cr.toFixed(2), cb.toFixed(2), ci.toFixed(2), roi.toFixed(6)].join(','));
        }
        var csv = lines.join('\r\n');
        var blob = null; try{ blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8' }); } catch(e){ blob = null; }
        var url = blob ? URL.createObjectURL(blob) : 'data:text/csv;charset=utf-8,' + encodeURIComponent('\uFEFF' + csv);
        var a = document.createElement('a'); a.href = url; a.download = 'roi_easyjur_1ano.csv'; document.body.appendChild(a); a.click(); a.remove(); if(blob && URL && URL.revokeObjectURL) URL.revokeObjectURL(url);
    }

    // Lógica do Tooltip
    function showTooltip(e) {
        if (!data) return;
        var rect = canvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;
        var pad = { l: 60, r: 60, t: 24, b: 40 };

        if (x < pad.l || x > (rect.width - pad.r) || y < pad.t || y > (rect.height - pad.b)) {
            tooltip.style.display = 'none';
            return;
        }

        var i = Math.round((x - pad.l) / (rect.width - pad.l - pad.r) * (DAYS - 1));
        if (i < 0 || i >= DAYS) {
            tooltip.style.display = 'none';
            return;
        }

        var day = i + 1;
        var eff = data.cumEff[i].toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 });
        var rev = data.cumRev[i].toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 });
        var inv = data.cumInv[i].toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 });
        var roi = data.cumROI[i] > 0.01 ? data.cumROI[i].toFixed(1) + 'x' : '0x';

        tooltip.innerHTML = `Dia ${day}<br>Eficiência: ${eff}<br>Faturamento: ${rev}<br>Investimento: ${inv}<br>ROI: ${roi}`;
        tooltip.style.left = `${e.clientX + 10}px`;
        tooltip.style.top = `${e.clientY + 10}px`;
        tooltip.style.display = 'block';
    }

    function hideTooltip() {
        tooltip.style.display = 'none';
    }

    canvas.addEventListener('mousemove', showTooltip);
    canvas.addEventListener('mouseout', hideTooltip);

    // Lógica do Acordeão
    var acc = document.getElementsByClassName("accordion")[0];
    acc.addEventListener("click", function() {
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.maxHeight) {
            panel.style.maxHeight = null;
        } else {
            panel.style.maxHeight = panel.scrollHeight + "px";
        }
    });

    byId('calc').addEventListener('click', draw);
    byId('csv').addEventListener('click', downloadCsv);
    window.addEventListener('resize', draw);
    draw();
})();
</script>
</body>
</html>
